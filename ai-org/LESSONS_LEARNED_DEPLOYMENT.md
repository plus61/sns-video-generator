# デプロイメント失敗からの教訓

## 判断ミスのパターン

### 1. エラーメッセージの表面的理解
- ❌ 「.nextディレクトリが見つからない」→「ディレクトリの問題」
- ✅ 「.nextディレクトリが見つからない」→「ビルドが実行されていない」

### 2. 焦りによる本質からの逸脱
- ❌ エラーが続く → 別の方法を試す → さらに複雑化
- ✅ エラーが続く → 基本に戻る → シンプルな解決

### 3. デバッグの省略
- ❌ エラーだけ見て対処
- ✅ ビルドログ全体を確認

## チェックリスト

### Next.jsデプロイ前の確認
1. [ ] `npm run build`がDockerfile内で実行されているか
2. [ ] ビルドが成功しているか（ログ確認）
3. [ ] .dockerignoreが.nextを除外していないか
4. [ ] 起動コマンドが`npm start`（本番）か

### エラー対処の原則
1. **基本に戻る**: 複雑な解決策の前にシンプルな方法を確認
2. **ログを読む**: エラーメッセージだけでなくビルドログ全体を確認
3. **段階的確認**: ローカル → Dockerローカル → 本番環境

## 典型的な失敗パターン

### パターン1: ビルドスキップ
```dockerfile
# ❌ 間違い
CMD ["npm", "run", "dev"]  # 開発モードはビルドしない

# ✅ 正解
RUN npm run build
CMD ["npm", "start"]
```

### パターン2: .dockerignore
```
# ❌ 間違い
.next  # ビルド結果を除外してしまう

# ✅ 正解
# .next  # コメントアウトまたは削除
```

## 結論

**「動かない」ときは複雑化ではなく簡素化を選ぶ**

1. エラーの本質を理解する
2. 最小構成で動作確認
3. 段階的に機能追加

この経験を通じて、デプロイメントの基本原則の重要性を再認識しました。