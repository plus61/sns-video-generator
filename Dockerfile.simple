# Railway用シンプルDockerfile - 確実に動作する最小構成
FROM node:18-alpine

WORKDIR /app

# 依存関係ファイルをコピー
COPY package*.json ./

# 全ての依存関係をインストール（本番用とビルド用）
RUN npm install --legacy-peer-deps

# アプリケーションコードをコピー
COPY . .

# 環境変数設定
ENV NODE_ENV=production
ENV NEXT_TELEMETRY_DISABLED=1

# ビルド実行
RUN npm run build

# .nextディレクトリの存在確認（デバッグ用）
RUN ls -la && ls -la .next && echo "Build completed successfully"

# ポート設定
EXPOSE 3000

# 環境変数
ENV NODE_ENV=production

# 起動コマンド - 直接Next.jsを起動
CMD ["npm", "start"]